var s=function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function t(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}var n,i;function s(){}(i=n=n||{}).CREATE="create",i.SEND="send",i.SET="set",i.REMOVE="remove";var o,r,a=n,c=function(){function e(e,t){this._id=e,this._name=t,this._screenResolution="",this._screenColorDepth="",this._screenWidth=0,this._screenHeight=0,this._referer="",this._pageUrl="",this._isTest=!1,this._headers={},this._userFlow=""}var t=e.prototype;return t.toJSON=function(){return{screenResolution:this._screenResolution,screenColorDepth:this._screenColorDepth,screenWidth:this._screenWidth,screenHeight:this._screenHeight,referer:this._referer,pageUrl:this._pageUrl,trackerId:this._id}},t.getId=function(){return this._id},t.getTrackerName=function(){return this._name},t.isTest=function(){return this._isTest},t.setScreenResolution=function(e){this._screenResolution=e},t.setScreenColorDepth=function(e){this._screenColorDepth=e},t.setScreenWidth=function(e){this._screenWidth=e},t.setScreenHeight=function(e){this._screenHeight=e},t.setTest=function(e){this._isTest=e},t.setPageUrl=function(e){this._pageUrl=e},t.setReferer=function(e){this._referer=e},t.setHeaders=function(e){this._headers=e||{}},t.getHeaders=function(){return this._headers},t.setUserFlow=function(e){this._userFlow=e||""},t.getUserFlow=function(){return this._userFlow},e}(),u=function(e){function n(t){var n;return(n=e.call(this)||this)._options=t,n}t(n,e);var i=n.prototype;return i.getScreenResolution=function(){return window.screen.width+"x"+window.screen.height},i.getViewportSize=function(){var e=document.documentElement,t=document.body,n=t&&t.clientWidth&&t.clientHeight,i=[];return e&&e.clientWidth&&e.clientHeight&&("CSS1Compat"===document.compatMode||!n)?i=[e.clientWidth,e.clientHeight]:n&&(i=[t.clientWidth,t.clientHeight]),i},i.getScreenColorDepth=function(){return window.screen.colorDepth+"-bit"},i.getIngestionType=function(){return this._options.ingestionType},i.execute=function(e){var t=new c(this._options.id,this._options.name);t.setScreenResolution(this.getScreenResolution());var n=this.getViewportSize();t.setScreenWidth(n[0]),t.setScreenHeight(n[1]),t.setScreenColorDepth(this.getScreenColorDepth()),this._options.doneCallback&&this._options.doneCallback(t),this._options.test&&t.setTest(!0),e(t)},n}(s),h=function(){function e(e){var t=this;this.dequeue=function(){return!t.isEmpty()&&t._commands.shift()},this.dequeueAndProcessNext=function(){t._state=3,t.dequeue()&&t.process()},this.clearAndResetInterval=function(){window.clearTimeout(t._setTimeoutId),t._setTimeoutId=0},this.process=function(){t.clearAndResetInterval(),0==t._commands.length?(t._state=1,t._flushCallback()):(t._state=2,t._commands[0]&&t._commands[0].execute(t.dequeueAndProcessNext))},this._commands=[],this._state=0,this._flushCallback=e,this._intervalTimeOut=3e3,this._setTimeoutId=0}var t=e.prototype;return t.isEmpty=function(){return 0===this._commands.length},t.enqueue=function(e){var t=this;this._commands.push(e),2!==this._state&&0!==this._state&&("BATCH"===e.getIngestionType()?this._setTimeoutId||(this._setTimeoutId=window.setTimeout(function(){t.process()},this._intervalTimeOut)):this.process())},e}(),d=function(){function t(e,t,n,i){this._eventLabel=e,this._eventType=t,this._eventValue=n,this._data=i,this._timestamp=Date.now()}return t.prototype.toJSON=function(){return e({eventName:this._eventLabel,type:this._eventType,value:this._eventValue,timestamp:this._timestamp},this._data)},t}(),l=((o={}).pageview="PageView",o.click="Click",o.error="Error",o.custom="Custom",o),p=["click","custom","error","pageview"],f=["BATCH","IMMEDIATE"],_=function(n){function i(t){var i;return(i=n.call(this)||this)._options=t,i._validate(t)&&(i._options=e({eventName:l[t.eventType],value:document.title},t)),i}t(i,n);var s=i.prototype;return s._validate=function(e){if(p.indexOf(e.eventType)<0)throw Error("Event "+e.eventType+" is not supported");if(f.indexOf(e.ingestionType)<0)throw Error("Ingestion type "+e.ingestionType+" is not supported");switch(e.eventType){case"click":case"custom":case"error":if(!e.eventName||!e.value)throw Error("Event ("+e.eventType+"): eventName or value is missing. Skipping event logging");break;default:return!0}return!0},s.getIngestionType=function(){return this._options.ingestionType},s.execute=function(e){var t=this._options,n=new d(t.eventName,t.eventType,t.value,t.data);this._options.doneCallback&&this._options.doneCallback(n),e(n)},i}(s);(r=r||{}).AUTH="AUTH";var g,m=r,v=function(){function t(e){var t=this;this._tenantId=e,this._callbackMapping={},window.JSNetworkBridge&&window.JSNetworkBridge.processRequest&&(window.PhonePe={},window.PhonePe.MessagingHandler={},window.PhonePe.MessagingHandler.callback=function(e,n,i,s){t._callbackMapping[e]&&t._callbackMapping[e](n,i,s)})}var n=t.prototype;return n.updateCallbackMapping=function(e,t){this._callbackMapping[e]=t},n.sendXHR=function(e){var t=new XMLHttpRequest;t.withCredentials=!0,t.open(e.method,e.url,!0),t.setRequestHeader("Content-Type","application/json"),e.headers&&(delete e.headers.cookie,delete e.headers.origin),e.headers&&Object.keys(e.headers).map(function(n){t.setRequestHeader(n,(null==e?void 0:e.headers)&&(null==e?void 0:e.headers[n])||"")}),t.onreadystatechange=function(){this.readyState!==XMLHttpRequest.DONE||200!==this.status&&204!==this.status||e.cb&&e.cb()},"POST"==e.method?t.send(JSON.stringify(e.requestBody)):t.send()},n.sendBridgeRequest=function(e){var t={baseUrl:e.baseUrl,subUrl:e.subUrl,httpMethod:e.method,headers:e.headers,bodyJSON:JSON.stringify(e.requestBody),"content-type":"application/json",callbackId:e.callbackId};window.JSNetworkBridge.processRequest(JSON.stringify(t))},n.send=function(e){window.JSNetworkBridge&&window.JSNetworkBridge.processRequest?(e.callbackId&&e.callbackFn&&this.updateCallbackMapping(e.callbackId,e.callbackFn),this.sendBridgeRequest(e)):this.sendXHR(e)},n.initClient=function(e){var t=1e9*Math.random(),n={url:"https://api.phonepe.com/apis/garfield/v1/init/"+this._tenantId,baseUrl:"https://api.phonepe.com/apis/garfield/v1",subUrl:"bridge/init/"+this._tenantId,method:"POST",cb:e,headers:{cookie:document.cookie,origin:window.location.origin,"X-NAMESPACE-ID":this._tenantId},callbackFn:function(t,n){var i;void 0===n&&(n=""),"1"===t&&(((i=JSON.parse(atob(n))).headers&&i.headers["set-cookie"]||[]).forEach(function(e){document.cookie=e}),e&&e())},callbackId:t};this.send(n)},n.processAndSend=function(t,n){t.setPageUrl(window.location.protocol+"//"+window.location.hostname+window.location.pathname),t.setReferer(document.referrer);var i={};t.isTest()&&(i={"X-TESTING_ENABLED":"true"});var s,o,r={url:(s=t.getUserFlow(),o=this._tenantId,s===m.AUTH?"https://api.phonepe.com/apis/garfield/v1/"+o+"/auth/ingest":"https://api.phonepe.com/apis/garfield/v1/ingest"),baseUrl:"https://api.phonepe.com/apis/garfield/v1",subUrl:"bridge/ingest",method:"POST",requestBody:e({},t.toJSON(),{events:n,namespaceId:this._tenantId}),headers:e({cookie:document.cookie,origin:window.location.origin,"X-NAMESPACE-ID":this._tenantId},i,t.getHeaders()),"content-type":"application/json"};this.send(r)},t}(),w=function(e){function n(t){var n;return(n=e.call(this)||this)._options=t,n}t(n,e);var i=n.prototype;return i.execute=function(e){var t=this._options,n=t.tracker,i=t.userFlow;n.setHeaders(t.headers),n.setUserFlow(i),this._options.doneCallback&&this._options.doneCallback(),e(n)},i.getIngestionType=function(){return this._options.ingestionType},n}(s),k=function(){function t(e){var t=this;this.start=function(){window.addEventListener("load",t.startProcessing)},this.addTracker=function(e){t._trackers.push(e),t._events[e.getId()]=[]},this.addEvent=function(e,n){var i=t.getDefaultTracker().getId();void 0!==n&&(i=n),t._events[i].push(e)},this.startProcessing=function(){t._commandQueue.process()},this.flushEvents=function(){for(var e in t._events)0<t._events[e].length&&(t._networkManager.processAndSend(t.getTrackerById(e),t._events[e].map(function(e){return e.toJSON()})),t._events[e]=[])},this._trackers=[],this._events={},this._commandQueue=new h(this.flushEvents),this._networkManager=new v(e),this._networkManager.initClient(this.startProcessing)}var n=t.prototype;return n.getDefaultTracker=function(){return this._trackers[this._trackers.length-1]},n.getTrackerById=function(e){return this._trackers.filter(function(t){return t.getId()===e})[0]},n.queueCommand=function(t,n){switch(t.toLowerCase()){case a.CREATE:var i=e({doneCallback:this.addTracker},n),s=new u(i);this._commandQueue.enqueue(s);break;case a.SEND:var o=t.split("."),r=this.addEvent;if(1<o.length&&(r=function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return e.apply(void 0,i.concat(n))}}(this.addEvent,o[0])),n.eventType)try{s=new _(e({ingestionType:"BATCH"},n,{doneCallback:r})),this._commandQueue.enqueue(s)}catch(e){}break;case a.SET:this._commandQueue.process(),s=new w(e({},n,{doneCallback:function(){},tracker:this._trackers.filter(function(e){return e.getId()===n.id})[0]})),this._commandQueue.enqueue(s)}},t}(),T=new(function(){function e(e){this._commandManager=new k(e)}return e.prototype.executeCommand=function(e,t){var n={};switch(e.toLowerCase()){case a.CREATE:if("string"==typeof t)n.id=t;else if(!("id"in t))throw new Error("Missing field 'id' not sent while creating a Tracker");this._commandManager.queueCommand(a.CREATE,n=t);break;case a.SEND:"string"==typeof t?n.eventType=t:n=t,this._commandManager.queueCommand(a.SEND,n);break;case a.SET:this._commandManager.queueCommand(a.SET,t)}},e}())(window.GaNamespaceId),y=window.GarfieldObjName;null==(g=window[y].q)||g.map(function(e){T.executeCommand.apply(T,e)}),window[y]=function(e,t){T.executeCommand.call(T,e,t)}};"function"==typeof define&&define.amd?define(s):s();