const constants=Object.freeze({devBaseUrl:"dev.pdp.gokwik.co",sandboxBaseUrl:"sandbox.pdp.gokwik.co",qaBaseUrl:"qa.pdp.gokwik.co",prodBaseUrl:"pdp.gokwik.co",sandboxCoreToken:"SANDBOXKWIKSESSIONTOKEN",productionCoreToken:"KWIKSESSIONTOKEN",qaCoreToken:"QAKWIKSESSIONTOKEN",devToken:"DEVKWIKUSERTOKEN",sandboxToken:"SANDBOXKWIKUSERTOKEN",productionToken:"KWIKUSERTOKEN",qaToken:"QAKWIKUSERTOKEN",devCheckoutToken:"DEVKWIKPASSTOKEN",sandboxCheckoutToken:"SANDBOXKWIKPASSTOKEN",productionCheckoutToken:"KWIKPASSTOKEN",qaCheckoutToken:"QAKWIKPASSTOKEN",verified:"verified"}),storageKeysConstants=Object.freeze({isEmailRequired:"IS_EMAIL_REQUIRED",isUserCreated:"isUserCreated",kpAPIKey:"KP_API_KEY",isSSOLogin:"IS_SSO_LOGIN",isShopifySession:"isShopifySession",notifyPhoneNumber:"notifyph",kpNotificationChecked:"kp_notification_checked",couponApplied:"coupon_applied",isLogout:"isLogout"}),eventsNameConstants=Object.freeze({openLoginModal:"open_login_modal",kpSSOTokenForCustomMerchant:"kp_sso_token_for_custom_merchant",handleAccountButtonClick:"handle_account_button_click_for_custom_merchant"}),CUSTOM_EVENT_TYPE=Object.freeze({process_fingerprinting:"process_fingerprinting",store_visitor_information:"store_visitor_information",store_data_from_merchant:"store_data_from_merchant",kp_vst_cnt:"kp_vst_cnt"}),CORE_TOKEN_SESSION_TYPE=Object.freeze({VERIFIED:"verified",KP_SESSION:"kp_session_type",KP_VALID_SESSION:"kp_valid_session"}),COUNTRY_CODE_INDIA="+91";function getThemeId(){return"123456"}const getEnvPath=e=>{switch(e){case"dev":return constants.devBaseUrl;case"production":default:return constants.prodBaseUrl;case"sandbox":return constants.sandboxBaseUrl;case"qa":return constants.qaBaseUrl}};function processMessageQueue(){const e=document.getElementById("iframe-kp"),o=document.getElementById("process-sso");let t=null;if(e&&window.IS_KP_IFRAME_LOADED?t=e:o&&window.IS_PROCESS_SSO_LOADED&&(t=o),t&&t.contentWindow)for(;window.KP_MESSAGE_QUEUE.length>0;){const e=getValueFromCookiesOrLocalStorage("kp-request-id"),o=window.KP_MESSAGE_QUEUE.shift();if(0==window.kp_health_status)return document.getElementById("kp-login-button-header-logo")?.addEventListener("click",(()=>{window.location.href="/account"})),void document.getElementById("kp-login-button-header-logo-mobile")?.addEventListener("click",(()=>{window.location.href="/account"}));t.contentWindow.postMessage({...o,requestId:e},"*")}}function openIframe(e="",o=null){const t=getValueFromCookiesOrLocalStorage("kp_user_id");let n={type:"process-sso",event:e,mid:window.merchantInfo.mid,isLogout:sessionStorage.getItem("isLogout"),userId:t};o&&(e===CUSTOM_EVENT_TYPE.store_data_from_merchant?n.queryparams=o:e===CUSTOM_EVENT_TYPE.process_fingerprinting?n.visitorId=o:e===CUSTOM_EVENT_TYPE.store_visitor_information?n.visitorInfo=o:e===CUSTOM_EVENT_TYPE.kp_vst_cnt&&o?.m_count?n.mCount=o?.m_count:e===CUSTOM_EVENT_TYPE.kp_vst_cnt&&o?.m_kp_count?n.mKpCount=o?.m_kp_count:n.kcPhone=o),window.KP_MESSAGE_QUEUE.push(n);let s=document.getElementById("iframe-kp");const a=function(){window.IS_KP_IFRAME_LOADED=!0,window.removeEventListener("kp_iframe_loaded",processMessageQueue),processMessageQueue()},r=function(){window.IS_PROCESS_SSO_LOADED=!0,processMessageQueue()};if(s)window.addEventListener("kp_iframe_loaded",processMessageQueue),s.contentWindow&&window.IS_KP_IFRAME_LOADED?a():s.onload=a;else{const e=document.createElement("iframe");e.src=`https://${getEnvPath(window.merchantInfo.environment)}/kwikpass/kwikpass-sso.html`,e.id="process-sso",e.style.display="none",document.body.appendChild(e),window.addEventListener("kp_iframe_loaded",processMessageQueue),e.onload=r,e.contentWindow&&window.IS_PROCESS_SSO_LOADED?r():e.onload=r}}window.IS_KP_IFRAME_LOADED=!1,window.IS_PROCESS_SSO_LOADED=!1,window.KP_MESSAGE_QUEUE=[];const kpGetCookieValue=e=>{const o=document.cookie.split(";").map((e=>e.trim()));for(const t of o){const[o,n]=t.split("=");if(o===e)return n}return null},kpGetLocalStorageValue=(e,o=!0)=>o&&localStorage.getItem(e),getValueFromCookiesOrLocalStorage=(e,o=!0)=>{if("notify_phone_number"===e)return getNotifyPh();const t=kpGetCookieValue(e);if(null==t){return kpGetLocalStorageValue(e,o)}return t},kpSetCookie=(e,o,t,n=!1,s)=>{let a="",r="";if(t||s){const e=new Date;t&&e.setDate(e.getDate()+t),s&&e.setTime(e.getTime()+60*s*1e3),a="; expires="+e.toUTCString()}n&&(r=";domain="+getPdpUrl()),document.cookie=e+"="+(o||"")+a+"; SameSite=None; Secure; path=/"+r},setValueInCookiesAndLocalStorage=(e,o,t=!0,n=365)=>{kpSetCookie(e,o,n),t&&window.localStorage.setItem(e,o),e===XGokwikCoreToken(window.merchantInfo.environment)&&setValueInIDB(e,o)},kpDeleteLocalStorageValue=(e,o=!0)=>{o&&localStorage.removeItem(e)};function kpDeleteCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}const deleteValueFromCookiesAndLocalStorage=(e,o=!0)=>{kpDeleteCookie(e),kpDeleteLocalStorageValue(e,o),e===XGokwikCoreToken(window.merchantInfo.environment)&&deleteValueInIDB(e)};function XGokwikCoreToken(e){return"production"===e?constants.productionCoreToken:"sandbox"===e?constants.sandboxCoreToken:"qa"===e?constants.qaCoreToken:constants.sandboxCoreToken}function XGokwikToken(e){return"production"===e?constants.productionToken:"sandbox"===e?constants.sandboxToken:"qa"===e?constants.qaToken:constants.devToken}const getKwikpassCheckoutToken=e=>{switch(e){case"production":return constants.productionCheckoutToken;case"sandbox":return constants.sandboxCheckoutToken;case"qa":return constants.qaCheckoutToken;default:return constants.devCheckoutToken}};function handleCustomLogin(e){const o=getValueFromCookiesOrLocalStorage(XGokwikCoreToken(window.merchantInfo.environment)),t=sessionStorage.getItem(CORE_TOKEN_SESSION_TYPE.KP_SESSION);if(o&&JSON.parse(t)!==CORE_TOKEN_SESSION_TYPE.VERIFIED)handleLogout();else if(o)handleAccountButtonForCustomMerchant(e);else{const o=new CustomEvent(eventsNameConstants.openLoginModal,{detail:{isEmailRequired:e}});window.dispatchEvent(o)}}function handleAccountButtonLogin(e=!1){const o=getValueFromCookiesOrLocalStorage(XGokwikCoreToken(window.merchantInfo.environment)),t=sessionStorage.getItem(CORE_TOKEN_SESSION_TYPE.KP_SESSION);if(o&&JSON.parse(t)!==CORE_TOKEN_SESSION_TYPE.VERIFIED)handleLogout();else if(!o||o&&JSON.parse(t)!==CORE_TOKEN_SESSION_TYPE.VERIFIED){const o=new CustomEvent(eventsNameConstants.openLoginModal,{detail:{isEmailRequired:e}});window.dispatchEvent(o)}else{const o=new CustomEvent(eventsNameConstants.handleAccountButtonClick,{detail:{isEmailRequired:e}});window.dispatchEvent(o)}}function handleAccountButtonForCustomMerchant(e){handleAccountButtonLogin(e)}function getNotifyPh(){let e=kpGetLocalStorageValue("notify_phone_number")||kpGetCookieValue("notify_phone_number");if(e){const o=btoa(e);return o?.includes("|")||(e=`+91|${val}`),setValueInCookiesAndLocalStorage("notifyph",e),deleteValueFromCookiesAndLocalStorage("notify_phone_number"),e}const o=getValueFromCookiesOrLocalStorage("notifyph");return o?atob(o):null}function handleLogout(){sessionStorage.setItem(storageKeysConstants.isLogout,!0),deleteValueFromCookiesAndLocalStorage(XGokwikToken(window.merchantInfo.environment)),deleteValueFromCookiesAndLocalStorage(XGokwikCoreToken(window.merchantInfo.environment)),deleteValueFromCookiesAndLocalStorage(getKwikpassCheckoutToken(window.merchantInfo.environment)),deleteValueFromCookiesAndLocalStorage(storageKeysConstants.isEmailRequired),kpDeleteLocalStorageValue(storageKeysConstants.isUserCreated),deleteValueFromCookiesAndLocalStorage(storageKeysConstants.kpAPIKey),deleteValueFromCookiesAndLocalStorage(storageKeysConstants.isSSOLogin),sessionStorage.removeItem(storageKeysConstants.isShopifySession),deleteValueFromCookiesAndLocalStorage("notifyph"),kpDeleteCookie(storageKeysConstants.kpNotificationChecked),localStorage.removeItem("kp_email"),kpDeleteCookie(storageKeysConstants.couponApplied,"/"),deleteValueFromCookiesAndLocalStorage("rp-phone-number"),deleteValueFromCookiesAndLocalStorage("idb_ph_no"),sessionStorage.removeItem(CORE_TOKEN_SESSION_TYPE.KP_SESSION),sessionStorage.removeItem(CORE_TOKEN_SESSION_TYPE.KP_VALID_SESSION)}function kpUpdateDOM(){const e=getValueFromCookiesOrLocalStorage(XGokwikCoreToken(window.merchantInfo.environment)),o=sessionStorage.getItem(storageKeysConstants.isLogout),t=getNotifyPh();(!e&&!o||e&&!t)&&openIframe(eventsNameConstants.kpSSOTokenForCustomMerchant)}const DB_NAME="KP_DB",STORE_NAME="kp_storage",DB_VERSION=1;function openDB(){return new Promise(((e,o)=>{const t=indexedDB.open(DB_NAME,DB_VERSION);t.onupgradeneeded=e=>{const o=e.target.result;o.objectStoreNames.contains(STORE_NAME)||o.createObjectStore(STORE_NAME)},t.onsuccess=()=>{e(t.result)},t.onerror=()=>{o(t.error)}}))}async function setValueInIDB(e,o){const t=(await openDB()).transaction(STORE_NAME,"readwrite");return t.objectStore(STORE_NAME).put(o,e),t.complete||new Promise(((e,o)=>{t.oncomplete=e,t.onerror=o}))}async function deleteValueInIDB(e){const o=(await openDB()).transaction(STORE_NAME,"readwrite");return o.objectStore(STORE_NAME).delete(e),o.complete||new Promise(((e,t)=>{o.oncomplete=e,o.onerror=t}))}function trackEventKp(e={}){const{value:o,property:t,action:n="click",label:s,category:a}=e;if(!a||!s)return!1;const r={category:a,action:n,label:s,...void 0!==t&&{property:t},...void 0!==o&&{value:o}};if("undefined"!=typeof window){const e=new CustomEvent("snowplow_event",{detail:r});try{return window.dispatchEvent(e),!0}catch(e){return!1}}}function kwikForm(){const e=new CustomEvent("open_kf_modal",{detail:{show:!0}});window.dispatchEvent(e)}