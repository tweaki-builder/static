name: Dynamic Unzip

on:
  push:
    paths:
      - "*.zip"   # Run automatically when ZIP file is added/updated
  workflow_dispatch: # Still allow manual run

permissions:
  contents: write

jobs:
  unzip:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Debug - List files
        run: ls -R .

      - name: Find ZIP file in root
        id: find_zip
        run: |
          ZIP_PATH=$(find . -maxdepth 1 -type f -name "*.zip" | head -n 1)

          if [[ -z "$ZIP_PATH" ]]; then
            echo "âŒ No ZIP file in root directory"
            exit 1
          fi

          ZIP_FILE=$(basename "$ZIP_PATH")
          EXTRACT_FOLDER="${ZIP_FILE%.zip}"

          echo "ZIP_PATH=$ZIP_PATH" >> $GITHUB_ENV
          echo "EXTRACT_FOLDER=$EXTRACT_FOLDER" >> $GITHUB_ENV

      - name: Install unzip
        run: sudo apt-get install -y unzip

      - name: Unzip dynamically
        run: unzip -o "$ZIP_PATH" -d "$EXTRACT_FOLDER"

      - name: Delete ZIP file
        run: rm -f "$ZIP_PATH"

      - name: Commit extracted files
        run: |
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git add "$EXTRACT_FOLDER"
          git add -u   # detect deleted ZIP

          git commit -m "Extracted and removed ZIP: $EXTRACT_FOLDER" || echo "No changes"
          git push
